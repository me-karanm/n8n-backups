[{"createdAt":"2025-04-25T06:43:31.451Z","updatedAt":"2025-07-15T07:11:23.000Z","id":"glyoXIMJROx8FDfj","name":"message-wati-template-sent-status","active":true,"nodes":[{"parameters":{"httpMethod":"POST","path":"wati-template-sent-status","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-900,-440],"id":"e0b647da-2b54-408f-85d7-cd73026252c0","name":"Webhook","webhookId":"995fb7e3-a6b5-4b95-b41c-0c8f711ed722"},{"parameters":{"operation":"insert","collection":"lead_history","fields":"=action,actionType,leadId,messageCategory,MessageType,date,messageDescription,attachment,attachmentType,templateId,templateName,conversationId,whatsappMessageId,eventType","options":{}},"type":"n8n-nodes-base.mongoDb","typeVersion":1.1,"position":[320,-580],"id":"a97317af-e2b4-4f57-85a5-5a2f03af844b","name":"MongoDB","credentials":{"mongoDb":{"id":"HzXeWVmgs66LJTEK","name":"MongoDB PROD Account"}}},{"parameters":{"assignments":{"assignments":[{"id":"aed6da4a-b1c2-4017-89f0-8e1710977cb8","name":"event_name","value":"wati_message_sent","type":"string"},{"id":"3678a1e7-7cd5-4dec-b1b6-59f02aa3af13","name":"body.waId","value":"={{ $('Webhook').item.json.body.waId }}","type":"string"}]},"includeOtherFields":true,"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-440,-440],"id":"223b4652-cf3f-432f-91ab-d21898226d97","name":"Edit Fields"},{"parameters":{"jsCode":"return [\n  {\n    json: {\n      action: \"engagement\",\n      actionType: \"messages\",\n      leadId: $input.first().json.id,\n      messageCategory: \"whatsapp\",\n      MessageType: \"outgoing\",\n      date: new Date().toISOString(),\n      messageDescription: $('Webhook').first().json.body.text || \"No message content\",\n      attachment: null,\n      attachmentType: \"planeText\",\n      templateId: $('Webhook').first().json.body.templateId || null,\n      templateName: $('Webhook').first().json.body.templateName || null,\n      conversationId: $('Webhook').first().json.body.conversationId || null,\n      whatsappMessageId: $('Webhook').first().json.body.whatsappMessageId || null,\n      eventType: \"templateMessageSent\"\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[100,-580],"id":"2f8d5179-2379-463a-8e88-17234aac3af1","name":"Code"},{"parameters":{"workflowId":{"__rl":true,"value":"tnyhyyA6a3QrZG7L","mode":"list","cachedResultName":"Fetch Lead Details"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[-120,-580],"id":"f63478e2-2990-4169-8d69-6bd1489383b8","name":"Fetch Lead Details"},{"parameters":{"workflowId":{"__rl":true,"mode":"id","value":"wNnmwEArkBvL3flU"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[-660,-440],"id":"15a7aff6-d515-4528-b095-89e921f2b39f","name":"Update WhatsApp Message id in supabase (localMessageId)"}],"connections":{"Webhook":{"main":[[{"node":"Update WhatsApp Message id in supabase (localMessageId)","type":"main","index":0}]]},"Edit Fields":{"main":[[]]},"Code":{"main":[[{"node":"MongoDB","type":"main","index":0}]]},"Fetch Lead Details":{"main":[[{"node":"Code","type":"main","index":0}]]},"Update WhatsApp Message id in supabase (localMessageId)":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","timezone":"Asia/Kolkata","saveExecutionProgress":true,"callerPolicy":"workflowsFromSameOwner","errorWorkflow":"osaLco4lVgTtLpKH"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"webhook.miles-api.com","x-real-ip":"172.69.176.13","x-forwarded-host":"webhook.miles-api.com","x-forwarded-server":"webhook.miles-api.com","x-forwarded-for":"35.197.140.3, 172.69.176.13","connection":"close","content-length":"502","cf-ray":"94e9bd92882f33d1-SIN","cf-connecting-ip":"35.197.140.3","accept-encoding":"gzip, br","x-forwarded-proto":"https","content-type":"application/json; charset=utf-8","tracestate":"dd=s:0;p:485de6366bc1242a","cf-visitor":"{\"scheme\":\"https\"}","traceparent":"00-684ad7fd00000000c5bbe6a477730a47-485de6366bc1242a-00","x-datadog-tags":"_dd.p.tid=684ad7fd00000000","cdn-loop":"cloudflare; loops=1","cf-ipcountry":"SG","x-datadog-sampling-priority":"0","x-datadog-parent-id":"5214577064975344682","user-agent":"Wati-webhook/1.0 (https://wati.io; support@wati.io)","x-datadog-trace-id":"14248235440169749063"},"params":{},"query":{},"body":{"eventType":"templateMessageFailed","statusString":"Failed","localMessageId":"1863b3e3-aca8-4dbc-b9cf-36f927678d55","failedCode":"131026","failedDetail":"Message undeliverable","id":"684ad7fa091b335e1aeb0e7a","whatsappMessageId":"wamid.HBgMOTE3NTY4MDExMzIyFQIAERgSQTc2OEUwOENFQ0Q4ODI3M0Q5AA==","conversationId":"684ad7fa091b335e1aeb0e7c","ticketId":"684ad7fa091b335e1aeb0e7b","text":null,"type":"template","timestamp":"1749735421","assigneeId":null,"operatorEmail":"mandalam.karan@mileseducation.com"},"webhookUrl":"https://webhook.miles-api.com/webhook/wati-template-sent-status","executionMode":"production"}}]},"versionId":"b0fab0b5-c464-48d9-862b-69d31599f86b","triggerCount":1,"tags":[{"createdAt":"2025-04-28T13:47:05.635Z","updatedAt":"2025-04-28T13:47:05.635Z","id":"5trY9jUf4K12fkdk","name":"wati"},{"createdAt":"2025-07-15T07:07:49.926Z","updatedAt":"2025-07-15T07:07:49.926Z","id":"wJnVPrhSbmXUFztc","name":"martech"}]}]