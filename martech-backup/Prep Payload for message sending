[{"createdAt":"2025-06-04T13:22:57.581Z","updatedAt":"2025-07-15T07:10:51.000Z","id":"7BxbBnT5QnuqxTAF","name":"Prep Payload for message sending","active":false,"nodes":[{"parameters":{"inputSource":"passthrough"},"id":"c055762a-8fe7-4141-a639-df2372f30060","typeVersion":1.1,"name":"When Executed by Another Workflow","type":"n8n-nodes-base.executeWorkflowTrigger","position":[80,20]},{"parameters":{"jsCode":"const payload = $input.first().json;\n\nconst outputArray = payload.parameters.map(param => ({\n  name: param.paramName,\n  value: payload[param.paramName] ?? null\n}));\n\nreturn outputArray;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[500,20],"id":"11b1182f-67df-4992-88f6-6b0d302bfa9b","name":"Code"},{"parameters":{"aggregate":"aggregateAllItemData","destinationFieldName":"parameters","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[840,20],"id":"32207ad4-401f-491f-9227-ffd134e4df0e","name":"Aggregate"},{"parameters":{"assignments":{"assignments":[{"id":"65cb396f-7959-4bf3-9a4e-df3bc1a252ce","name":"template_name","value":"={{ $('When Executed by Another Workflow').item.json.template_name }}","type":"string"},{"id":"e208d361-4c60-42c8-bade-9c66b7139a46","name":"broadcast_name","value":"={{ $('When Executed by Another Workflow').item.json.broadcast_name }}","type":"string"},{"id":"b85e5cfd-b3b5-4665-93ba-9b24539f2319","name":"tenant_id","value":"={{ $('When Executed by Another Workflow').item.json.tenant_id }}","type":"string"},{"id":"32cd62d1-6de0-4504-bba6-87b6a0a19d16","name":"event_name","value":"={{ $('When Executed by Another Workflow').item.json.event_name }}","type":"string"},{"id":"b9b81388-5dc1-482d-a442-be70e7022c56","name":"whatsappNumber","value":"={{ $json.Phone__countryCode.replace('+','') }}{{ $json.Phone__phoneNumber }}","type":"string"},{"id":"d0a17f70-f1c1-4ada-84e3-feb09fc846cc","name":"lead_id","value":"={{ $json.id }}","type":"string"},{"id":"3a2ba66a-0450-4ca4-9b05-be4ab73f4776","name":"email","value":"={{ $json.Email__email }}","type":"string"},{"id":"eb85ff21-202a-4fcf-a173-f2f8ba06c6ee","name":"parameters","value":"={{ $('Aggregate').item.json.parameters }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1840,-240],"id":"40b2c998-7445-4d6f-a470-6deef1864ef4","name":"Edit Fields"},{"parameters":{"workflowId":{"__rl":true,"value":"eQzyHqrEBFVmbr6N","mode":"list","cachedResultName":"NEW Fetch Lead Details (lead_id)"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[1580,-240],"id":"9c20e6ae-361e-45f1-b10b-a9270b955233","name":"Execute Workflow"},{"parameters":{"workflowId":{"__rl":true,"value":"AqCXRLBEFDGVdTMl","mode":"list","cachedResultName":"(NEW) Send Template Message Through WATI"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{"waitForSubWorkflow":false}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[2100,-240],"id":"73fbab12-cd56-4e13-9ccb-35812d1af227","name":"Execute Workflow1"},{"parameters":{"assignments":{"assignments":[{"id":"c9da10e4-8407-4e8c-aefd-e7d72012e0b4","name":"lead_id","value":"={{ $('When Executed by Another Workflow').item.json.lead_id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1060,20],"id":"7724ed66-a24a-4e81-8a2f-7bf00e221198","name":"Edit Fields1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"064a8b6d-2c12-4604-9b3b-31e01f46c156","leftValue":"={{ $('When Executed by Another Workflow').item.json.database_type }}","rightValue":"mf3","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1280,20],"id":"f8d85bf3-ed26-4c05-a0b1-1405275956a5","name":"If"},{"parameters":{"assignments":{"assignments":[{"id":"65cb396f-7959-4bf3-9a4e-df3bc1a252ce","name":"template_name","value":"={{ $('When Executed by Another Workflow').item.json.template_name }}","type":"string"},{"id":"e208d361-4c60-42c8-bade-9c66b7139a46","name":"broadcast_name","value":"={{ $('When Executed by Another Workflow').item.json.broadcast_name }}","type":"string"},{"id":"b85e5cfd-b3b5-4665-93ba-9b24539f2319","name":"tenant_id","value":"={{ $('When Executed by Another Workflow').item.json.tenant_id }}","type":"string"},{"id":"32cd62d1-6de0-4504-bba6-87b6a0a19d16","name":"event_name","value":"={{ $('When Executed by Another Workflow').item.json.event_name }}","type":"string"},{"id":"b9b81388-5dc1-482d-a442-be70e7022c56","name":"whatsappNumber","value":"={{ $json.country_code.replace('+','') }}{{ $json.phone }}","type":"string"},{"id":"d0a17f70-f1c1-4ada-84e3-feb09fc846cc","name":"lead_id","value":"={{ $json.lead_id }}","type":"string"},{"id":"3a2ba66a-0450-4ca4-9b05-be4ab73f4776","name":"email","value":"={{ $json.email }}","type":"string"},{"id":"eb85ff21-202a-4fcf-a173-f2f8ba06c6ee","name":"parameters","value":"={{ $('Aggregate').item.json.parameters }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1860,100],"id":"5cdcc762-1b24-45d6-b232-5136df778c23","name":"Edit Fields2"},{"parameters":{"workflowId":{"__rl":true,"value":"AqCXRLBEFDGVdTMl","mode":"list","cachedResultName":"(NEW) Send Template Message Through WATI"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{"waitForSubWorkflow":false}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[2120,100],"id":"526eb80d-f89d-49e1-83a6-555cb3df8060","name":"Execute Workflow3"},{"parameters":{"workflowId":{"__rl":true,"mode":"list","value":"PCiL7akGFTA5QIrd","cachedResultName":"My Sub-Workflow 2"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[1600,100],"id":"360715e7-64c2-43e9-9a6c-7fac3720dc61","name":"MF3.0 Fetch Lead Details"}],"connections":{"When Executed by Another Workflow":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Execute Workflow":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Edit Fields1","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Execute Workflow1","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"Execute Workflow","type":"main","index":0}],[{"node":"MF3.0 Fetch Lead Details","type":"main","index":0}]]},"Edit Fields2":{"main":[[{"node":"Execute Workflow3","type":"main","index":0}]]},"MF3.0 Fetch Lead Details":{"main":[[{"node":"Edit Fields2","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{"When Executed by Another Workflow":[{"json":{"parameters":[{"paramName":"name","paramValue":"k"}],"template_name":"d3_called_and_positive_v1","broadcast_name":"d3_called_and_positive_v1","tenant_id":"439562","event_name":"called_positive","email":"gopikaprasoon19@gmail.com","lead_id":"1","phone":"+917034347947","webinar_date":null,"webinar_time":null,"link":null,"name":"Lead","visit_date":null,"visit_time":null,"visit_type":null,"country_code":null,"campaign_id":null,"course_id":"33","coming_from":null,"office_visit_id":null,"office_address":null,"maps_link":null,"spoc_name":null,"old_rescheduled_visit_id":null,"registration_email":null,"database_type":"mf3"}}]},"versionId":"31f01f0a-f20b-423d-9588-0eb851dd8a62","triggerCount":0,"tags":[{"createdAt":"2025-07-15T07:07:49.926Z","updatedAt":"2025-07-15T07:07:49.926Z","id":"wJnVPrhSbmXUFztc","name":"martech"}]}]