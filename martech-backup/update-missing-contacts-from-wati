[{"createdAt":"2025-04-21T09:30:22.497Z","updatedAt":"2025-07-15T07:15:12.000Z","id":"xQqC9lDl2u1qxdC4","name":"update-missing-contacts-from-wati","active":true,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-1160,-1220],"id":"59dd4779-3942-4dc6-bf44-eb84b94a9fa5","name":"When clicking ‘Test workflow’"},{"parameters":{"url":"https://live-mt-server.wati.io/413503/api/v1/getContacts","sendQuery":true,"queryParameters":{"parameters":[{"name":"pageSize","value":"100"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"*/*"},{"name":"Authorization","value":"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI4NGFiZDUzMy1mNmZlLTRmODEtODVlMS0zZjYxNTI2NDk0ZWIiLCJ1bmlxdWVfbmFtZSI6Im1hbmRhbGFtLmthcmFuQG1pbGVzZWR1Y2F0aW9uLmNvbSIsIm5hbWVpZCI6Im1hbmRhbGFtLmthcmFuQG1pbGVzZWR1Y2F0aW9uLmNvbSIsImVtYWlsIjoibWFuZGFsYW0ua2FyYW5AbWlsZXNlZHVjYXRpb24uY29tIiwiYXV0aF90aW1lIjoiMDQvMDQvMjAyNSAxMjoyMDowOSIsInRlbmFudF9pZCI6IjQxMzUwMyIsImRiX25hbWUiOiJtdC1wcm9kLVRlbmFudHMiLCJodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL3dzLzIwMDgvMDYvaWRlbnRpdHkvY2xhaW1zL3JvbGUiOiJBRE1JTklTVFJBVE9SIiwiZXhwIjoyNTM0MDIzMDA4MDAsImlzcyI6IkNsYXJlX0FJIiwiYXVkIjoiQ2xhcmVfQUkifQ.8xqEz39ggf6RghrEmXg-iHdwacDPfCgzwFexcJ3iaBQ"}]},"options":{"pagination":{"pagination":{"paginationMode":"responseContainsNextURL","nextURL":"={{ $response.body.link.nextPage }}","paginationCompleteWhen":"other","completeExpression":"={{ $response.body.link.nextPage.isEmpty() }}","requestInterval":2000}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1000,800],"id":"0706ffaa-c8f3-436d-8bb7-cd1106a444ad","name":"HTTP Request"},{"parameters":{"fieldToSplitOut":"contact_list","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-260,-1600],"id":"09c04a43-c2f4-46f8-901b-d6459076df12","name":"Split Out"},{"parameters":{"method":"POST","url":"https://mfx-prod-154625965269.asia-south1.run.app/enquiries/add","sendBody":true,"specifyBody":"json","jsonBody":"={\n\"first_name\":\"{{ $('Loop Over Items').item.json.customParams.pluck('name') }}\",\n\"last_name\":\" \",\n\"phone\":\"+{{ $('Loop Over Items').item.json.customParams[2].value }}\",\n\"contact_number\":\"+{{ $('Loop Over Items').item.json.customParams[2].value }}\",\n\"email\":\"{{ $('Loop Over Items').item.json.customParams[7]?.value || \"\"}}\",\n\"course_id\": {{ $('Loop Over Items').item.json.customParams[3]?.value || 1 }},\n\"whatsapp_opt_in\":true,\n\"educational_qualification\":null,\n\"campaign_id\": {{ $('Loop Over Items').item.json.customParams[5]?.value.toNumber() || 357 }} ,\n\"register_for_webinar\":true,\n\"coming_from\": \"wati_{{ $('Loop Over Items').item.json.customParams[5]?.value.toNumber() || 357 }}\",\n\"page_full_url\": \"{{ $('Loop Over Items').item.json.customParams[4]?.value || \"https://www.mileseducation.com\" }}\"\n}","options":{}},"id":"330c1d03-063b-4550-8bab-bc553dfddc9d","name":"HTTP Request1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1740,460],"retryOnFail":true,"alwaysOutputData":true,"onError":"continueErrorOutput"},{"parameters":{"amount":1},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[2080,440],"id":"f55681f2-249c-43f8-ad07-536b7b43d232","name":"Wait","webhookId":"7e04a38e-46dc-4268-9fdd-8b7692df4030"},{"parameters":{"operation":"select","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"net_enquiry","mode":"name"},"returnAll":true,"where":{"values":[{"column":"phone","condition":"LIKE","value":"=%{{ $json.phone.slice(2) }}%"},{"column":"coming_from","condition":"LIKE","value":"%wati%"}]},"sort":{"values":[{"column":"created_at","direction":"DESC"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1180,400],"id":"1bddb7f0-0c93-4142-88aa-50b38455b11a","name":"Postgres","alwaysOutputData":true,"retryOnFail":true,"credentials":{"postgres":{"id":"UlHvqQraJFrdqkr2","name":"MF Prod Read"}},"onError":"continueErrorOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"92cdddd5-3139-4a02-964f-d25520eae509","leftValue":"={{ $json.id }}","rightValue":"","operator":{"type":"number","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1480,380],"id":"ea8e0578-ca14-4e2b-9be2-2521e2977d5c","name":"If"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[940,240],"id":"f1748ba6-fd82-4867-ac38-c20f321cc764","name":"Loop Over Items"},{"parameters":{"options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-40,-1600],"id":"ba1108ce-71f3-446f-8bde-1a289c0ce938","name":"Convert to File"},{"parameters":{"url":"https://live-mt-server.wati.io/439562/api/v1/getContacts","sendQuery":true,"queryParameters":{"parameters":[{"name":"pageSize","value":"100"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"*/*"},{"name":"Authorization","value":"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI5M2MzOWRmZS0yOGFjLTQ0MTctYjk4ZS03ZWU0OTNlNmNjMDIiLCJ1bmlxdWVfbmFtZSI6Im1hbmRhbGFtLmthcmFuQG1pbGVzZWR1Y2F0aW9uLmNvbSIsIm5hbWVpZCI6Im1hbmRhbGFtLmthcmFuQG1pbGVzZWR1Y2F0aW9uLmNvbSIsImVtYWlsIjoibWFuZGFsYW0ua2FyYW5AbWlsZXNlZHVjYXRpb24uY29tIiwiYXV0aF90aW1lIjoiMDYvMDYvMjAyNSAxMzo0MjowOSIsInRlbmFudF9pZCI6IjQzOTU2MiIsImRiX25hbWUiOiJtdC1wcm9kLVRlbmFudHMiLCJodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL3dzLzIwMDgvMDYvaWRlbnRpdHkvY2xhaW1zL3JvbGUiOiJBRE1JTklTVFJBVE9SIiwiZXhwIjoyNTM0MDIzMDA4MDAsImlzcyI6IkNsYXJlX0FJIiwiYXVkIjoiQ2xhcmVfQUkifQ.8Yw-NvNQKSaL1N1XV70oEm1GACRGrVcGXUqXmvyphsA"}]},"options":{"pagination":{"pagination":{"paginationMode":"responseContainsNextURL","nextURL":"={{ $response.body.link.nextPage }}","paginationCompleteWhen":"other","completeExpression":"={{ $response.body.link.nextPage.isEmpty() }}","requestInterval":2000}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-600,-1600],"id":"8b0d66af-86f5-4925-b163-cd1fb31d433b","name":"HTTP Request2"},{"parameters":{"url":"https://live-mt-server.wati.io/413503/api/v1/getContacts","sendQuery":true,"queryParameters":{"parameters":[{"name":"pageSize","value":"100"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"*/*"},{"name":"Authorization","value":"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJmNjA0ZTM2NC03MjZlLTQzNjctYTAwMC1kODBiZWJjNTc1ZmYiLCJ1bmlxdWVfbmFtZSI6Im1hbmRhbGFtLmthcmFuQG1pbGVzZWR1Y2F0aW9uLmNvbSIsIm5hbWVpZCI6Im1hbmRhbGFtLmthcmFuQG1pbGVzZWR1Y2F0aW9uLmNvbSIsImVtYWlsIjoibWFuZGFsYW0ua2FyYW5AbWlsZXNlZHVjYXRpb24uY29tIiwiYXV0aF90aW1lIjoiMDUvMjEvMjAyNSAwNzoxMjoyMSIsInRlbmFudF9pZCI6IjQxMzUwMyIsImRiX25hbWUiOiJtdC1wcm9kLVRlbmFudHMiLCJodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL3dzLzIwMDgvMDYvaWRlbnRpdHkvY2xhaW1zL3JvbGUiOiJBRE1JTklTVFJBVE9SIiwiZXhwIjoyNTM0MDIzMDA4MDAsImlzcyI6IkNsYXJlX0FJIiwiYXVkIjoiQ2xhcmVfQUkifQ.e01c8FazzXtpCgQDf_2lT7aqv4zkCzPrYbWt0x_J6cQ"}]},"options":{"pagination":{"pagination":{"paginationMode":"responseContainsNextURL","nextURL":"={{ $response.body.link.nextPage }}","paginationCompleteWhen":"other","completeExpression":"={{ $response.body.link.nextPage.isEmpty() }}","requestInterval":2000}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-580,-1240],"id":"f8daca07-a824-48ba-bec5-b73752cadd7f","name":"HTTP Request3"},{"parameters":{"url":"https://live-mt-server.wati.io/444763/api/v1/getContacts","sendQuery":true,"queryParameters":{"parameters":[{"name":"pageSize","value":"100"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"accept","value":"*/*"},{"name":"Authorization","value":"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIwZTRjYTEwYy1jODVlLTRjMGYtODlmNy0wYTRiNTEwMzU4NzMiLCJ1bmlxdWVfbmFtZSI6Im1hbmRhbGFtLmthcmFuQG1pbGVzZWR1Y2F0aW9uLmNvbSIsIm5hbWVpZCI6Im1hbmRhbGFtLmthcmFuQG1pbGVzZWR1Y2F0aW9uLmNvbSIsImVtYWlsIjoibWFuZGFsYW0ua2FyYW5AbWlsZXNlZHVjYXRpb24uY29tIiwiYXV0aF90aW1lIjoiMDUvMjAvMjAyNSAxMToyMToxMiIsInRlbmFudF9pZCI6IjQ0NDc2MyIsImRiX25hbWUiOiJtdC1wcm9kLVRlbmFudHMiLCJodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL3dzLzIwMDgvMDYvaWRlbnRpdHkvY2xhaW1zL3JvbGUiOiJBRE1JTklTVFJBVE9SIiwiZXhwIjoyNTM0MDIzMDA4MDAsImlzcyI6IkNsYXJlX0FJIiwiYXVkIjoiQ2xhcmVfQUkifQ.2zFIONy1a5VrqbaIb6jHiqvVcQp6FO1jX-6JcJFQz2k"}]},"options":{"pagination":{"pagination":{"paginationMode":"responseContainsNextURL","nextURL":"={{ $response.body.link.nextPage }}","paginationCompleteWhen":"other","completeExpression":"={{ $response.body.link.nextPage.isEmpty() }}","requestInterval":2000}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-580,-860],"id":"49712123-95dc-4949-a465-42d3dc7ceea5","name":"HTTP Request4"},{"parameters":{"fieldToSplitOut":"contact_list","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-140,-860],"id":"972b6b5a-77e7-4b33-a6f6-ec22f1905a97","name":"Split Out1"},{"parameters":{"options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[140,-880],"id":"68815d94-9dc4-45d1-b645-6cdbd4ed654e","name":"Convert to File1"},{"parameters":{"fieldToSplitOut":"contact_list","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-140,-1240],"id":"ed316c05-d3e8-46f4-a703-9b8ed5aad0bf","name":"Split Out2"},{"parameters":{"options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[80,-1240],"id":"1e21f1e8-9088-4ac8-b7b1-24a6af9d680c","name":"Convert to File2"}],"connections":{"When clicking ‘Test workflow’":{"main":[[{"node":"HTTP Request2","type":"main","index":0},{"node":"HTTP Request3","type":"main","index":0},{"node":"HTTP Request4","type":"main","index":0}]]},"HTTP Request":{"main":[[]]},"Split Out":{"main":[[{"node":"Convert to File","type":"main","index":0}]]},"HTTP Request1":{"main":[[{"node":"Wait","type":"main","index":0}]]},"Postgres":{"main":[[{"node":"If","type":"main","index":0}],[{"node":"Loop Over Items","type":"main","index":0}]]},"If":{"main":[[{"node":"Loop Over Items","type":"main","index":0}],[{"node":"HTTP Request1","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Postgres","type":"main","index":0}]]},"Wait":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"HTTP Request2":{"main":[[{"node":"Split Out","type":"main","index":0}]]},"Split Out1":{"main":[[{"node":"Convert to File1","type":"main","index":0}]]},"Split Out2":{"main":[[{"node":"Convert to File2","type":"main","index":0}]]},"HTTP Request4":{"main":[[{"node":"Split Out1","type":"main","index":0}]]},"HTTP Request3":{"main":[[{"node":"Split Out2","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","timezone":"Asia/Kolkata","callerPolicy":"workflowsFromSameOwner","saveExecutionProgress":true,"errorWorkflow":"JugK3JVukMVLS3ax"},"staticData":{"node:Schedule Trigger":{"recurrenceRules":[]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"2817c3b7-15d2-456c-9fe8-fb6c667d9443","triggerCount":0,"tags":[{"createdAt":"2025-07-15T07:07:49.926Z","updatedAt":"2025-07-15T07:07:49.926Z","id":"wJnVPrhSbmXUFztc","name":"martech"}]}]