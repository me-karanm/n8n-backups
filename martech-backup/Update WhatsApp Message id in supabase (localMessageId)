[{"createdAt":"2025-04-28T14:40:24.901Z","updatedAt":"2025-07-15T07:09:45.000Z","id":"wNnmwEArkBvL3flU","name":"Update WhatsApp Message id in supabase (localMessageId)","active":false,"nodes":[{"parameters":{"inputSource":"passthrough"},"id":"c055762a-8fe7-4141-a639-df2372f30060","typeVersion":1.1,"name":"When Executed by Another Workflow","type":"n8n-nodes-base.executeWorkflowTrigger","position":[260,340]},{"parameters":{"operation":"update","tableId":"wati_template_message_id","filters":{"conditions":[{"keyName":"localMessageid","condition":"eq","keyValue":"={{ $json.body.localMessageId }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"wa_msg_id","fieldValue":"={{ $json.body.whatsappMessageId }}"},{"fieldId":"phone","fieldValue":"={{ $json.body.waId.slice(2) }}"},{"fieldId":"template_name","fieldValue":"={{ $json.body.templateName }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[740,140],"id":"96ed9e4d-54fa-43e9-b18c-b7fabed9f9a2","name":"Supabase","credentials":{"supabaseApi":{"id":"6stEFLC7gtftREcf","name":"Supabase Campaign manager"}}},{"parameters":{"tableId":"wati_template_message_status","fieldsUi":{"fieldValues":[{"fieldId":"wa_msg_id","fieldValue":"={{ $json.wa_msg_id }}"},{"fieldId":"message_sent","fieldValue":"={{ $now }}"},{"fieldId":"convesation_id","fieldValue":"={{ $('When Executed by Another Workflow').item.json.body.conversationId }}"},{"fieldId":"template_name","fieldValue":"={{ $('When Executed by Another Workflow').item.json.body.templateName }}"},{"fieldId":"phone","fieldValue":"={{ $json.phone }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[960,140],"id":"b9f7f9a0-cbad-466a-93f3-5c23ebf56c98","name":"Supabase1","credentials":{"supabaseApi":{"id":"6stEFLC7gtftREcf","name":"Supabase Campaign manager"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"86d6bbdf-8f22-4060-a7cc-22aff824908d","leftValue":"={{ $json.body.eventType }}","rightValue":"templateMessageFailed","operator":{"type":"string","operation":"notContains"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[480,340],"id":"d4b6f59f-18cf-42ea-b4af-bc45a52d21e4","name":"If"},{"parameters":{"operation":"update","tableId":"wati_template_message_id","filters":{"conditions":[{"keyName":"localMessageid","condition":"eq","keyValue":"={{ $json.body.localMessageId }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"wa_msg_id","fieldValue":"={{ $json.body.whatsappMessageId }}"},{"fieldId":"isFailed","fieldValue":"true"},{"fieldId":"failure_reason","fieldValue":"={{ $('When Executed by Another Workflow').item.json.body.failedDetail }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[760,420],"id":"6caa4d87-31d2-450a-9041-dc1973a04cc0","name":"Supabase2","credentials":{"supabaseApi":{"id":"6stEFLC7gtftREcf","name":"Supabase Campaign manager"}}},{"parameters":{"tableId":"wati_template_message_status","fieldsUi":{"fieldValues":[{"fieldId":"wa_msg_id","fieldValue":"={{ $json.wa_msg_id }}"},{"fieldId":"convesation_id","fieldValue":"={{ $('When Executed by Another Workflow').item.json.body.conversationId }}"},{"fieldId":"phone","fieldValue":"={{ $json.phone }}"},{"fieldId":"isFailed","fieldValue":"true"},{"fieldId":"failure_reason","fieldValue":"={{ $('When Executed by Another Workflow').item.json.body.failedDetail }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[980,420],"id":"17ddbadb-6af4-4391-ba1e-5fab98cecdea","name":"Supabase3","credentials":{"supabaseApi":{"id":"6stEFLC7gtftREcf","name":"Supabase Campaign manager"}}}],"connections":{"When Executed by Another Workflow":{"main":[[{"node":"If","type":"main","index":0}]]},"Supabase":{"main":[[{"node":"Supabase1","type":"main","index":0}]]},"If":{"main":[[{"node":"Supabase","type":"main","index":0}],[{"node":"Supabase2","type":"main","index":0}]]},"Supabase2":{"main":[[{"node":"Supabase3","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","timezone":"Asia/Kolkata","saveExecutionProgress":true,"callerPolicy":"workflowsFromSameOwner","errorWorkflow":"osaLco4lVgTtLpKH"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"When Executed by Another Workflow":[{"json":{"headers":{"host":"webhook.miles-api.com","x-real-ip":"172.68.164.109","x-forwarded-host":"webhook.miles-api.com","x-forwarded-server":"webhook.miles-api.com","x-forwarded-for":"35.240.163.128, 172.68.164.109","connection":"close","content-length":"585","x-datadog-sampling-priority":"0","x-datadog-tags":"_dd.p.tid=685d22af00000000","content-type":"application/json; charset=utf-8","tracestate":"dd=s:0;p:136611cdcb738f7a","cf-ray":"955c106f680cf8f6-SIN","traceparent":"00-685d22af00000000102043138e2c34da-136611cdcb738f7a-00","user-agent":"Wati-webhook/1.0 (https://wati.io; support@wati.io)","x-datadog-trace-id":"1162002455130289370","x-datadog-parent-id":"1397824309924433786","accept-encoding":"gzip, br","cdn-loop":"cloudflare; loops=1","cf-connecting-ip":"35.240.163.128","cf-ipcountry":"SG","cf-visitor":"{\"scheme\":\"https\"}","x-forwarded-proto":"https"},"params":{},"query":{},"body":{"eventType":"templateMessageFailed","statusString":"Failed","localMessageId":"b7928a94-b7aa-44a7-8724-30c37a8452af","failedCode":"131049","failedDetail":"Message undeliverable as Meta has restricted it for higher quality messaging - retry again in a few days","id":"685d22ace96e18a75ee4f263","whatsappMessageId":"wamid.HBgMOTE3OTkwMTgxNzA2FQIAERgSMkQxRjIzQkEzQjA5ODY3MkY5AA==","conversationId":"6853cff5600141513a178eb1","ticketId":"6853cff5600141513a178eb0","text":null,"type":"template","timestamp":"1750934191","assigneeId":null,"operatorEmail":"mandalam.karan@mileseducation.com"},"webhookUrl":"https://webhook.miles-api.com/webhook/wati-template-sent-status","executionMode":"production"}}]},"versionId":"0f878bfa-c739-4212-9876-c5d5da1a0b5e","triggerCount":0,"tags":[{"createdAt":"2025-04-28T13:47:05.635Z","updatedAt":"2025-04-28T13:47:05.635Z","id":"5trY9jUf4K12fkdk","name":"wati"},{"createdAt":"2025-04-29T06:36:23.362Z","updatedAt":"2025-04-29T06:36:23.362Z","id":"H1D37pNFvSAXh7Qg","name":"supabase"},{"createdAt":"2025-07-15T07:07:49.926Z","updatedAt":"2025-07-15T07:07:49.926Z","id":"wJnVPrhSbmXUFztc","name":"martech"}]}]