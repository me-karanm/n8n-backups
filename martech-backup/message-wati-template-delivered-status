[{"createdAt":"2025-04-28T13:53:56.607Z","updatedAt":"2025-07-15T07:13:32.000Z","id":"AechL73lftudM8jd","name":"message-wati-template-delivered-status","active":true,"nodes":[{"parameters":{"httpMethod":"POST","path":"wati-template-delivered-status","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-1140,-360],"id":"74f0df36-d429-4dbb-a19d-4eb41a7713c8","name":"Webhook","webhookId":"ef233f2d-b527-4d9a-9437-217cc381dd39"},{"parameters":{"operation":"insert","collection":"lead_history","fields":"=action,actionType,leadId,messageCategory,MessageType,date,messageDescription,attachment,attachmentType,templateId,templateName,conversationId,whatsappMessageId,eventType","options":{}},"type":"n8n-nodes-base.mongoDb","typeVersion":1.1,"position":[60,-360],"id":"0ac78708-156e-467c-953f-7e773d0beb76","name":"MongoDB","credentials":{"mongoDb":{"id":"HzXeWVmgs66LJTEK","name":"MongoDB PROD Account"}}},{"parameters":{"assignments":{"assignments":[{"id":"aed6da4a-b1c2-4017-89f0-8e1710977cb8","name":"event_name","value":"wati_message_delivered","type":"string"}]},"includeOtherFields":true,"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-600,-360],"id":"06d448d1-8127-4ed6-9964-4e1628b154e1","name":"Edit Fields"},{"parameters":{"jsCode":"return [\n  {\n    json: {\n      action: \"engagement\",\n      actionType: \"messages\",\n      leadId: $input.first().json.id,\n      messageCategory: \"whatsapp\",\n      MessageType: \"outgoing\",\n      date: new Date().toISOString(),\n      messageDescription: $('Webhook').first().json.body.text || \"No message content\",\n      attachment: null,\n      attachmentType: \"planeText\",\n      templateId: $('Webhook').first().json.body.templateId || null,\n      templateName: $('Update Message Status in Supabase (wa_msg_id)').first().json.template_name || null,\n      conversationId: $('Webhook').first().json.body.conversationId || null,\n      whatsappMessageId: $('Webhook').first().json.body.whatsappMessageId || null,\n      eventType: $('Edit Fields').first().json.event_name\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-160,-360],"id":"384bb068-5fab-4e38-b34f-ac7e2b0f2af6","name":"Code"},{"parameters":{"workflowId":{"__rl":true,"value":"tnyhyyA6a3QrZG7L","mode":"list","cachedResultName":"Fetch Lead Details"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[-380,-360],"id":"fc7d4814-31d3-4028-ae0d-bad0ecbdf01a","name":"Fetch Lead Details"},{"parameters":{"workflowId":{"__rl":true,"value":"1tIqfuoSd8QoBAqu","mode":"list","cachedResultName":"Update Message Status in Supabase (wa_msg_id)"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[-860,-360],"id":"a5659bc7-b50e-4dd7-b20e-0c1f5619a8f8","name":"Update Message Status in Supabase (wa_msg_id)"}],"connections":{"Webhook":{"main":[[{"node":"Update Message Status in Supabase (wa_msg_id)","type":"main","index":0}]]},"Edit Fields":{"main":[[]]},"Code":{"main":[[{"node":"MongoDB","type":"main","index":0}]]},"Fetch Lead Details":{"main":[[{"node":"Code","type":"main","index":0}]]},"Update Message Status in Supabase (wa_msg_id)":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","timezone":"Asia/Kolkata","saveExecutionProgress":true,"callerPolicy":"workflowsFromSameOwner","errorWorkflow":"osaLco4lVgTtLpKH"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"webhook.miles-api.com","x-real-ip":"104.23.175.55","x-forwarded-host":"webhook.miles-api.com","x-forwarded-server":"webhook.miles-api.com","x-forwarded-for":"35.247.162.22, 104.23.175.55","connection":"close","content-length":"488","cf-ray":"937c08aea88945c8-SIN","cf-connecting-ip":"35.247.162.22","accept-encoding":"gzip, br","x-forwarded-proto":"https","content-type":"application/json; charset=utf-8","tracestate":"dd=s:0;p:65376331c4fa339c","cf-visitor":"{\"scheme\":\"https\"}","traceparent":"00-681054a500000000577eb663a3d4c4a8-65376331c4fa339c-00","x-datadog-tags":"_dd.p.tid=681054a500000000","cdn-loop":"cloudflare; loops=1","cf-ipcountry":"SG","x-datadog-sampling-priority":"0","x-datadog-parent-id":"7293407186959086492","user-agent":"Wati-webhook/1.0 (https://wati.io; support@wati.io)","x-datadog-trace-id":"6304677067431920808"},"params":{},"query":{},"body":{"eventType":"sentMessageDELIVERED_v2","statusString":"Delivered","localMessageId":"f50bf474-2b62-40c1-a011-6cdaff5c7a97","id":"681054a35a50bb752512e021","whatsappMessageId":"wamid.HBgMOTE5Mjc0NDAyMDI0FQIAERgSNUIwRjQwNDIwNDYzQkZCMEQyAA==","conversationId":"681054a05ee1570400b33cf7","ticketId":"681054a05a50bb752512dfff","text":" *Letâ€™s start with your name -* what should I call you?","type":"text","timestamp":"1745900706","assigneeId":"67c80f50f77648a5f8a9b5b2","operatorEmail":null},"webhookUrl":"https://webhook.miles-api.com/webhook/wati-template-delivered-status","executionMode":"production"}}]},"versionId":"32171ad4-8964-48cd-9b4e-d90e9b32dd1f","triggerCount":1,"tags":[{"createdAt":"2025-04-28T13:47:05.635Z","updatedAt":"2025-04-28T13:47:05.635Z","id":"5trY9jUf4K12fkdk","name":"wati"},{"createdAt":"2025-07-15T07:07:49.926Z","updatedAt":"2025-07-15T07:07:49.926Z","id":"wJnVPrhSbmXUFztc","name":"martech"}]}]