[{"createdAt":"2025-05-07T17:59:39.290Z","updatedAt":"2025-07-15T07:14:39.000Z","id":"qOzbD1S3lt7xXAqN","name":"Office Visit Reminder D-1 Day","active":true,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-520,0],"id":"3a50a91c-5649-4c00-a721-75c6765786ce","name":"When clicking ‘Test workflow’"},{"parameters":{"operation":"executeQuery","query":"SELECT DISTINCT ON (\"Phone\".\"phoneNumber\")\n  \"Phone\".\"phoneNumber\" AS \"phone\",\n  \"Lead\".\"id\" AS \"lead_id\",\n   \"Lead\".\"uuid\" AS \"uuid\",\n  \"Email\".\"email\" AS \"email\",\n  \"Lead\".\"first_name\" AS \"first_name\",\n    \"public\".\"office_visit\".\"google_meet_link\" AS \"google_meet_link\",\n  DATE_TRUNC('minute', \"public\".\"office_visit\".\"visit_date\") AS \"visit_date\",\n  \"public\".\"office_visit\".\"schedule\" AS \"schedule\",\n  \"public\".\"office_visit\".\"visitCityId\" AS \"visitCityId\"\nFROM\n  \"public\".\"office_visit\"\nLEFT JOIN \"public\".\"lead\" AS \"Lead\" ON \"public\".\"office_visit\".\"lead_id\" = \"Lead\".\"id\"\nLEFT JOIN \"public\".\"phone\" AS \"Phone\" ON \"Lead\".\"id\" = \"Phone\".\"leadId\"\nLEFT JOIN \"public\".\"email\" AS \"Email\" ON \"Lead\".\"id\" = \"Email\".\"leadId\"\nWHERE\n  \"public\".\"office_visit\".\"visit_date\" >= CAST(CAST((NOW() + INTERVAL '1 day') AS date) AS timestamptz)\n  AND \"public\".\"office_visit\".\"visit_date\" < CAST(CAST((NOW() + INTERVAL '2 day') AS date) AS timestamptz)\n  AND \"Phone\".\"isWhatsAppNumber\" = TRUE\nORDER BY\n  \"Phone\".\"phoneNumber\",\n  DATE_TRUNC('minute', \"public\".\"office_visit\".\"visit_date\") DESC","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-300,-200],"id":"4fbd9d4d-a75c-4325-8421-66b03b0fd09c","name":"Postgres","credentials":{"postgres":{"id":"UlHvqQraJFrdqkr2","name":"MF Prod Read"}}},{"parameters":{"assignments":{"assignments":[{"id":"f0eeccba-c024-4666-80c7-db9e9273442b","name":"phone","value":"={{ $('Loop Over Items').item.json.phone }}","type":"string"},{"id":"d69a93f3-8191-4bf4-9550-739cce1c3897","name":"lead_id","value":"={{ $('Loop Over Items').item.json.lead_id }}","type":"number"},{"id":"72d8f6ec-f749-4db2-81c7-a92467b7329d","name":"uuid","value":"={{ $('Loop Over Items').item.json.uuid }}","type":"string"},{"id":"9fa3f8c2-c333-4c0a-90b1-654439fcbd8d","name":"first_name","value":"={{ $('Loop Over Items').item.json.first_name }}","type":"string"},{"id":"0378bbc2-0ac9-4e7c-818d-cb10f58a8bd1","name":"email","value":"={{ $('Loop Over Items').item.json.email }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[980,60],"id":"582aeed2-88d1-43df-8e51-a4cb9636cdfe","name":"Edit Fields"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[420,-220],"id":"05c86f93-7a55-4fa0-b99c-fcd2cfde8389","name":"Loop Over Items"},{"parameters":{"operation":"select","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"miles_office","mode":"name"},"returnAll":true,"where":{"values":[{"column":"id","value":"={{ $json.visitCityId }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[760,60],"id":"cbc72473-b762-4a8e-b890-58acada74309","name":"Postgres1","credentials":{"postgres":{"id":"UlHvqQraJFrdqkr2","name":"MF Prod Read"}}},{"parameters":{"workflowId":{"__rl":true,"value":"lOgLi51AQQR2VRrS","mode":"list","cachedResultName":"NEW Send Contact to Netcore"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[1220,60],"id":"c1b12dd2-e3ab-435c-9a4f-7185e7c52ab1","name":"Send Contact to Netcore"},{"parameters":{"workflowId":{"__rl":true,"value":"MYduhGIhCmgTaVQu","mode":"list","cachedResultName":"(NEW) Send Activity to Netcore"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[1700,60],"id":"0b09c12a-0808-4fa6-b143-8b17ecb3d33a","name":"Send Activity to Netcore"},{"parameters":{"assignments":{"assignments":[{"id":"bfac5b39-51ca-4b34-a863-94354028a8c0","name":"event_name","value":"office_visit_reminder_d_1_day","type":"string"},{"id":"7f12661f-908a-49be-9833-5683294766a6","name":"first_name","value":"={{ $('Loop Over Items').item.json.first_name }}","type":"string"},{"id":"d87ddac7-7a02-4f79-b644-ac0236d849b7","name":"uuid","value":"={{ $json.uuid }}","type":"string"},{"id":"ea7bd06e-b8bb-4b99-aff5-5fc15f4daffb","name":"email","value":"={{ $json.email }}","type":"string"},{"id":"b46fa980-1422-4146-9613-f43f21765b2f","name":"phone","value":"={{ $json.phone }}","type":"string"},{"id":"fb90cac9-2c77-4fec-b5bc-9538a976efe4","name":"visit_date","value":"={{ $('Loop Over Items').item.json.visit_date }}","type":"string"},{"id":"30009d33-3d38-472b-a432-76b81f962b70","name":"schedule","value":"={{ $('Loop Over Items').item.json.schedule }}","type":"string"},{"id":"677da69e-1126-4670-9f0c-761801c501d5","name":"lead_id","value":"={{ $('Loop Over Items').item.json.lead_id }}","type":"number"},{"id":"9c27f4ee-46da-4e1a-9c86-92774299c92a","name":"maps_link","value":"={{ $('Postgres1').item.json.location_url }}","type":"string"},{"id":"50410257-66ff-4837-8c73-5ba878712912","name":"city","value":"={{ $('Postgres1').item.json.city }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1440,60],"id":"74c7732a-81ac-448d-a6b7-5f7a290705b2","name":"Edit Fields1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"e565575d-7845-49f1-add2-25da9a511c6a","leftValue":"={{ $json.google_meet_link }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[140,-200],"id":"26180f45-a230-41d0-b50a-105ebf75b159","name":"If"},{"parameters":{"rule":{"interval":[{"field":"cronExpression","expression":"0 3 20 * * *"}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-560,-440],"id":"ebd0811b-f796-43cb-be91-e0601d9b9172","name":"Schedule Trigger"},{"parameters":{"maxItems":5},"type":"n8n-nodes-base.limit","typeVersion":1,"position":[-80,-200],"id":"384011f9-b9bf-42af-8d38-18e76bc31a45","name":"Limit","disabled":true}],"connections":{"When clicking ‘Test workflow’":{"main":[[{"node":"Postgres","type":"main","index":0}]]},"Postgres":{"main":[[{"node":"Limit","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Send Contact to Netcore","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Postgres1","type":"main","index":0}]]},"Postgres1":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Send Contact to Netcore":{"main":[[{"node":"Edit Fields1","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"Send Activity to Netcore","type":"main","index":0}]]},"If":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"Postgres","type":"main","index":0}]]},"Send Activity to Netcore":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Limit":{"main":[[{"node":"If","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","timezone":"Asia/Kolkata","saveExecutionProgress":true,"callerPolicy":"workflowsFromSameOwner","errorWorkflow":"osaLco4lVgTtLpKH"},"staticData":{"node:Schedule Trigger":{"recurrenceRules":[]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"3d63a52e-07c0-402e-8c91-baa7a16bbb9d","triggerCount":1,"tags":[{"createdAt":"2025-07-15T07:07:49.926Z","updatedAt":"2025-07-15T07:07:49.926Z","id":"wJnVPrhSbmXUFztc","name":"martech"}]}]