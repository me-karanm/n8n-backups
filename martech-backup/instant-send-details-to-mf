[{"createdAt":"2025-04-11T11:02:24.974Z","updatedAt":"2025-07-15T07:15:22.000Z","id":"zHOPEFgTOMtf48Aj","name":"instant-send-details-to-mf","active":true,"nodes":[{"parameters":{"httpMethod":"POST","path":"instant-send-details-to-mf","responseMode":"responseNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-520,-80],"id":"058de03b-0c0f-4445-8afb-5ff580bab1ad","name":"Webhook","webhookId":"b3c8b731-4e05-4709-b74f-9a4ad3c523b1"},{"parameters":{"respondWith":"json","responseBody":"={\n  \"leadId\": \"{{ $('Postgres1').item.json.id }}\"\n} ","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[1020,-320],"id":"fac383db-e4a6-488d-b5dd-61eeff5b2006","name":"Respond to Webhook"},{"parameters":{"operation":"select","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"phone","mode":"name"},"returnAll":true,"where":{"values":[{"column":"phoneNumber","value":"={{ $json.body.phone.slice(2) }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.5,"position":[-80,-320],"id":"c352a1be-83b4-41a6-a7bb-72b9b17aef36","name":"Postgres","credentials":{"postgres":{"id":"VPJUosohtvWNBW4H","name":"MF Prod (DO NOT USE)"}}},{"parameters":{"assignments":{"assignments":[{"id":"062eae17-1061-40cd-9a97-8970b645b60e","name":"leadId","value":"={{ $json.leadId }}","type":"number"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[140,-320],"id":"dcc40e98-095b-4e2d-a74f-bd796336bcaa","name":"Edit Fields"},{"parameters":{"operation":"update","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"lead","mode":"name"},"columns":{"mappingMode":"defineBelow","value":{"status":true,"whatsapp_opt_in":true,"intrested_to_work_in_us":"={{ $json.intentValue.toBoolean() }}","call_opt_in":true,"email_opt_in":true,"message_opt_in":true,"id":"={{ $json.leadId }}","graduation_year":"={{ $json.graduationYear }}"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":false},{"id":"status","displayName":"status","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":false},{"id":"created_by","displayName":"created_by","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"updated_by","displayName":"updated_by","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"created_at","displayName":"created_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"updated_at","displayName":"updated_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"candidate_id","displayName":"candidate_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"first_name","displayName":"first_name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"last_name","displayName":"last_name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"city","displayName":"city","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"city_num_verify","displayName":"city_num_verify","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"whatsapp_opt_in","displayName":"whatsapp_opt_in","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":false},{"id":"intrested_to_work_in_us","displayName":"intrested_to_work_in_us","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":false},{"id":"linked_in_url","displayName":"linked_in_url","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"graduation_year","displayName":"graduation_year","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"uuid","displayName":"uuid","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"call_opt_in","displayName":"call_opt_in","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":false},{"id":"email_opt_in","displayName":"email_opt_in","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":false},{"id":"message_opt_in","displayName":"message_opt_in","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":false},{"id":"followup_date","displayName":"followup_date","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"call_status","displayName":"call_status","required":false,"defaultMatch":false,"display":true,"type":"options","canBeUsedToMatch":true,"options":[{"name":"1","value":"1"},{"name":"2","value":"2"},{"name":"3","value":"3"}],"removed":true},{"id":"last_call_date","displayName":"last_call_date","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"is_DND","displayName":"is_DND","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":true},{"id":"lead_category","displayName":"lead_category","required":false,"defaultMatch":false,"display":true,"type":"options","canBeUsedToMatch":true,"options":[{"name":"1","value":"1"},{"name":"2","value":"2"},{"name":"3","value":"3"},{"name":"4","value":"4"}],"removed":true},{"id":"eligibility_code","displayName":"eligibility_code","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"eligibility_course","displayName":"eligibility_course","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"count_for_month","displayName":"count_for_month","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"miles_office_id","displayName":"miles_office_id","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"reffered_by","displayName":"reffered_by","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"spocId","displayName":"spocId","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"srSpocId","displayName":"srSpocId","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"pathwayProfileId","displayName":"pathwayProfileId","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"pushed_to_ats","displayName":"pushed_to_ats","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":true},{"id":"bridge_course_recommendation","displayName":"bridge_course_recommendation","required":false,"defaultMatch":false,"display":true,"type":"object","canBeUsedToMatch":true,"removed":true},{"id":"notify_followup","displayName":"notify_followup","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":true},{"id":"re_enquiry_date","displayName":"re_enquiry_date","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"attempt_count","displayName":"attempt_count","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.5,"position":[580,-320],"id":"0b838182-4cd8-47d8-9d1b-4dd87a905e61","name":"Postgres1","credentials":{"postgres":{"id":"VPJUosohtvWNBW4H","name":"MF Prod (DO NOT USE)"}}},{"parameters":{"jsCode":"return items.map(({ json }) => {\n  const currentYear = new Date().getFullYear();\n\n  // Mapping 1: Graduation year\n  let gradYear = currentYear;\n  switch (( $('Webhook').first().json.body.qualification|| '').toUpperCase()) {\n    case 'GRADUATE':\n      gradYear = currentYear - 1;\n      break;\n    case 'GRADUATING IN 2025':\n      gradYear = currentYear;\n      break;\n    case 'NOT A GRADUATE':\n      gradYear = currentYear + 1;\n      break;\n    default:\n      gradYear = currentYear;\n  }\n\n  // Mapping 2: Intent response\n  const intentRaw = ( $('Webhook').first().json.body.work_in_us|| '').toLowerCase();\n  const intentMapped = ['yes', 'maybe'].includes(intentRaw) ? 1 : 0;\n\n  return {\n    json: {\n      ...json,\n      graduationYear: gradYear,\n      intentValue: intentMapped,\n    }\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[360,-320],"id":"dea375b9-e4f9-4dbf-8ea9-5a3e695f86d7","name":"Code"},{"parameters":{"schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"email","mode":"name"},"columns":{"mappingMode":"defineBelow","value":{"email":"={{ $('Webhook').item.json.body.email }}","leadId":"={{ $json.id }}"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"status","displayName":"status","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":true},{"id":"created_by","displayName":"created_by","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"updated_by","displayName":"updated_by","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"created_at","displayName":"created_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"updated_at","displayName":"updated_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"email","displayName":"email","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"isActive","displayName":"isActive","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":true},{"id":"isMasked","displayName":"isMasked","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":true},{"id":"isPrimary","displayName":"isPrimary","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":true},{"id":"maskedEmail","displayName":"maskedEmail","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"contact_removal_request_date","displayName":"contact_removal_request_date","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"reason_for_delete","displayName":"reason_for_delete","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"mode_of_communication","displayName":"mode_of_communication","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"leadId","displayName":"leadId","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[780,-320],"id":"7b98d8ee-96bc-4a27-a638-a2a77d9bf122","name":"Postgres2","credentials":{"postgres":{"id":"VPJUosohtvWNBW4H","name":"MF Prod (DO NOT USE)"}},"onError":"continueErrorOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"7b4f1b0d-fdf1-4f47-8ee1-e5d7382fb4ae","leftValue":"={{ $json.body.qualification }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-260,-80],"id":"ce105e21-0368-45eb-a294-3854699c7e7c","name":"If"},{"parameters":{"respondWith":"json","responseBody":"={{ $json.leadId }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[1780,0],"id":"c38d5679-fe83-4433-802d-e7c8e794508f","name":"Respond to Webhook1"},{"parameters":{"operation":"select","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"phone","mode":"name"},"returnAll":true,"where":{"values":[{"column":"phoneNumber","value":"={{ $json.body.phone.slice(2) }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.5,"position":[240,0],"id":"ef5a10fd-b3ed-43de-a5b4-6a0e79183be3","name":"Postgres3","credentials":{"postgres":{"id":"VPJUosohtvWNBW4H","name":"MF Prod (DO NOT USE)"}}},{"parameters":{"assignments":{"assignments":[{"id":"062eae17-1061-40cd-9a97-8970b645b60e","name":"leadId","value":"={{ $json.leadId }}","type":"number"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[460,0],"id":"a0cfdb79-affb-4bc6-a816-cc14d5885508","name":"Edit Fields1"},{"parameters":{"operation":"update","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"lead","mode":"name"},"columns":{"mappingMode":"defineBelow","value":{"status":true,"whatsapp_opt_in":true,"call_opt_in":true,"email_opt_in":true,"message_opt_in":true,"id":"={{ $json.leadId }}","graduation_year":"={{ $('Code2').item.json.year }}"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":false},{"id":"status","displayName":"status","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":false},{"id":"created_by","displayName":"created_by","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"updated_by","displayName":"updated_by","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"created_at","displayName":"created_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"updated_at","displayName":"updated_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"candidate_id","displayName":"candidate_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"first_name","displayName":"first_name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"last_name","displayName":"last_name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"city","displayName":"city","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"city_num_verify","displayName":"city_num_verify","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"whatsapp_opt_in","displayName":"whatsapp_opt_in","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":false},{"id":"intrested_to_work_in_us","displayName":"intrested_to_work_in_us","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":true},{"id":"linked_in_url","displayName":"linked_in_url","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"graduation_year","displayName":"graduation_year","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"uuid","displayName":"uuid","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"call_opt_in","displayName":"call_opt_in","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":false},{"id":"email_opt_in","displayName":"email_opt_in","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":false},{"id":"message_opt_in","displayName":"message_opt_in","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":false},{"id":"followup_date","displayName":"followup_date","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"call_status","displayName":"call_status","required":false,"defaultMatch":false,"display":true,"type":"options","canBeUsedToMatch":true,"options":[{"name":"1","value":"1"},{"name":"2","value":"2"},{"name":"3","value":"3"}],"removed":true},{"id":"last_call_date","displayName":"last_call_date","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"is_DND","displayName":"is_DND","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":true},{"id":"lead_category","displayName":"lead_category","required":false,"defaultMatch":false,"display":true,"type":"options","canBeUsedToMatch":true,"options":[{"name":"1","value":"1"},{"name":"2","value":"2"},{"name":"3","value":"3"},{"name":"4","value":"4"}],"removed":true},{"id":"eligibility_code","displayName":"eligibility_code","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"eligibility_course","displayName":"eligibility_course","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"count_for_month","displayName":"count_for_month","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"miles_office_id","displayName":"miles_office_id","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"reffered_by","displayName":"reffered_by","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"spocId","displayName":"spocId","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"srSpocId","displayName":"srSpocId","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"pathwayProfileId","displayName":"pathwayProfileId","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"pushed_to_ats","displayName":"pushed_to_ats","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":true},{"id":"bridge_course_recommendation","displayName":"bridge_course_recommendation","required":false,"defaultMatch":false,"display":true,"type":"object","canBeUsedToMatch":true,"removed":true},{"id":"notify_followup","displayName":"notify_followup","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":true},{"id":"re_enquiry_date","displayName":"re_enquiry_date","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"attempt_count","displayName":"attempt_count","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.5,"position":[740,0],"id":"7c55d229-4f23-49dc-8cb6-1707e2505b82","name":"Postgres4","credentials":{"postgres":{"id":"VPJUosohtvWNBW4H","name":"MF Prod (DO NOT USE)"}}},{"parameters":{"schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"email","mode":"name"},"columns":{"mappingMode":"defineBelow","value":{"email":"={{ $('Webhook').item.json.body.email }}","leadId":"={{ $json.id }}"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"status","displayName":"status","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":true},{"id":"created_by","displayName":"created_by","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"updated_by","displayName":"updated_by","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"created_at","displayName":"created_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"updated_at","displayName":"updated_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":true},{"id":"email","displayName":"email","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"isActive","displayName":"isActive","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":true},{"id":"isMasked","displayName":"isMasked","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":true},{"id":"isPrimary","displayName":"isPrimary","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":true,"removed":true},{"id":"maskedEmail","displayName":"maskedEmail","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"contact_removal_request_date","displayName":"contact_removal_request_date","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"reason_for_delete","displayName":"reason_for_delete","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"mode_of_communication","displayName":"mode_of_communication","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"leadId","displayName":"leadId","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1100,0],"id":"bfde4d76-a071-4bbe-9cbc-2a6a55d48c31","name":"Postgres5","credentials":{"postgres":{"id":"VPJUosohtvWNBW4H","name":"MF Prod (DO NOT USE)"}},"onError":"continueErrorOutput"},{"parameters":{"jsCode":"return items.map(item => {\n  const label = $input.first().json.body.NEETStatus;  // change 'label' to the key you're using\n  const currentYear = new Date().getFullYear();\n\n  let year;\n  switch (label) {\n    case \"Attempted Last Year\":\n      year = currentYear - 1;\n      break;\n    case \"Attempted This Year\":\n      year = currentYear;\n      break;\n    case \"Will Attempt in 2026\":\n      year = currentYear + 1;\n      break;\n    default:\n      year = null; // handle unknown labels\n  }\n\n  return {\n    json: {\n      ...item.json,\n      year\n    }\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[20,0],"id":"56a33f8b-33ee-4b83-93c9-96fc560a8290","name":"Code2"},{"parameters":{"assignments":{"assignments":[{"id":"125c43c1-b5aa-4b02-82be-8c10aef0b8e5","name":"leadId","value":"={{ $('Postgres4').item.json.id }}","type":"number"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1540,100],"id":"aa92b71c-c620-4dae-840a-6a943186e235","name":"Edit Fields2"},{"parameters":{"assignments":{"assignments":[{"id":"d553417f-f35b-4cb0-a139-b2bb58f33677","name":"leadId","value":"={{ $json.leadId }}","type":"number"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1320,-100],"id":"5fb5bf51-f502-408f-a90a-854c60c75029","name":"Edit Fields3"}],"connections":{"Webhook":{"main":[[{"node":"If","type":"main","index":0}]]},"Postgres":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Code","type":"main","index":0}]]},"Postgres1":{"main":[[{"node":"Postgres2","type":"main","index":0}]]},"Code":{"main":[[{"node":"Postgres1","type":"main","index":0}]]},"Postgres2":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}],[{"node":"Respond to Webhook","type":"main","index":0}]]},"If":{"main":[[{"node":"Postgres","type":"main","index":0}],[{"node":"Code2","type":"main","index":0}]]},"Postgres3":{"main":[[{"node":"Edit Fields1","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"Postgres4","type":"main","index":0}]]},"Postgres4":{"main":[[{"node":"Postgres5","type":"main","index":0}]]},"Postgres5":{"main":[[{"node":"Edit Fields3","type":"main","index":0}],[{"node":"Edit Fields2","type":"main","index":0}]]},"Code2":{"main":[[{"node":"Postgres3","type":"main","index":0}]]},"Edit Fields2":{"main":[[{"node":"Respond to Webhook1","type":"main","index":0}]]},"Edit Fields3":{"main":[[{"node":"Respond to Webhook1","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","timezone":"Asia/Kolkata","saveExecutionProgress":true,"callerPolicy":"workflowsFromSameOwner","errorWorkflow":"JugK3JVukMVLS3ax"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"webhook.miles-api.com","x-real-ip":"162.158.189.177","x-forwarded-host":"webhook.miles-api.com","x-forwarded-server":"webhook.miles-api.com","x-forwarded-for":"34.126.87.128, 162.158.189.177","connection":"close","content-length":"94","cf-ray":"93fd70a7afd83f76-SIN","cf-connecting-ip":"34.126.87.128","accept-encoding":"gzip, br","x-forwarded-proto":"https","content-type":"application/json; charset=UTF-8","tracestate":"dd=s:0;p:0006156eb7c2c6a6","cf-visitor":"{\"scheme\":\"https\"}","traceparent":"00-0aeb0fc18356691fe4e7620e587951f1-0006156eb7c2c6a6-00","x-datadog-tags":"_dd.p.tid=0aeb0fc18356691f","cdn-loop":"cloudflare; loops=1","cf-ipcountry":"SG","x-datadog-sampling-priority":"0","x-datadog-parent-id":"1712415133845158","x-datadog-trace-id":"16494259974021140977"},"params":{},"query":{},"body":{"phone":"917349296479","NEETStatus":"Attempted This Year","email":"doctor8testing@gmail.com"},"webhookUrl":"https://webhook.miles-api.com/webhook/instant-send-details-to-mf","executionMode":"production"}}]},"versionId":"48e0caf8-8981-42cd-b1a9-73a16bb5767d","triggerCount":1,"tags":[{"createdAt":"2025-07-15T07:07:49.926Z","updatedAt":"2025-07-15T07:07:49.926Z","id":"wJnVPrhSbmXUFztc","name":"martech"}]}]