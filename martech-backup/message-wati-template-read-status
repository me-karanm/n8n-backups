[{"createdAt":"2025-04-28T13:55:32.924Z","updatedAt":"2025-07-15T07:13:34.000Z","id":"SdkUXWgCqCYXUgqI","name":"message-wati-template-read-status","active":true,"nodes":[{"parameters":{"httpMethod":"POST","path":"wati-template-read-status","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-1140,-360],"id":"24176eca-c9de-42a3-8c3b-72676514ce37","name":"Webhook","webhookId":"457eb08a-3bae-4591-9d1a-0aa3b556b167"},{"parameters":{"operation":"insert","collection":"lead_history","fields":"=action,actionType,leadId,messageCategory,MessageType,date,messageDescription,attachment,attachmentType,templateId,templateName,conversationId,whatsappMessageId,eventType","options":{}},"type":"n8n-nodes-base.mongoDb","typeVersion":1.1,"position":[60,-360],"id":"aaf70920-959d-432a-8cf2-f358b84f9f95","name":"MongoDB","credentials":{"mongoDb":{"id":"HzXeWVmgs66LJTEK","name":"MongoDB PROD Account"}}},{"parameters":{"assignments":{"assignments":[{"id":"aed6da4a-b1c2-4017-89f0-8e1710977cb8","name":"event_name","value":"wati_message_read","type":"string"},{"id":"ce473dd2-59d9-4510-820d-8bf085746742","name":"template_name","value":"={{ $json.template_name }}","type":"string"}]},"includeOtherFields":true,"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-600,-360],"id":"9b64d95c-62be-4a07-ad24-c4f32673184f","name":"Edit Fields"},{"parameters":{"jsCode":"return [\n  {\n    json: {\n      action: \"engagement\",\n      actionType: \"messages\",\n      leadId: $input.first().json.id,\n      messageCategory: \"whatsapp\",\n      MessageType: \"outgoing\",\n      date: new Date().toISOString(),\n      messageDescription: $('Webhook').first().json.body.text || \"No message content\",\n      attachment: null,\n      attachmentType: \"planeText\",\n      templateId: $('Webhook').first().json.body.templateId || null,\n      templateName: $('Update Message Status in Supabase (wa_msg_id)').first().json.template_name || null,\n      conversationId: $('Webhook').first().json.body.conversationId || null,\n      whatsappMessageId: $('Webhook').first().json.body.whatsappMessageId || null,\n      eventType: $('Edit Fields').first().json.event_name\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-160,-360],"id":"95e39e9d-7848-4b4d-92e9-610c85e3dc86","name":"Code"},{"parameters":{"workflowId":{"__rl":true,"value":"tnyhyyA6a3QrZG7L","mode":"list","cachedResultName":"Fetch Lead Details"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[-380,-360],"id":"1fb32966-9c59-4cab-a430-20fa4f753a80","name":"Fetch Lead Details"},{"parameters":{"workflowId":{"__rl":true,"value":"1tIqfuoSd8QoBAqu","mode":"list","cachedResultName":"Update Message Status in Supabase (wa_msg_id)"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[-860,-360],"id":"c73d7f2f-422f-427d-b7d8-7b1728b895b4","name":"Update Message Status in Supabase (wa_msg_id)"}],"connections":{"Webhook":{"main":[[{"node":"Update Message Status in Supabase (wa_msg_id)","type":"main","index":0}]]},"Edit Fields":{"main":[[]]},"Code":{"main":[[{"node":"MongoDB","type":"main","index":0}]]},"Fetch Lead Details":{"main":[[{"node":"Code","type":"main","index":0}]]},"Update Message Status in Supabase (wa_msg_id)":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","timezone":"Asia/Kolkata","saveExecutionProgress":true,"callerPolicy":"workflowsFromSameOwner","errorWorkflow":"osaLco4lVgTtLpKH"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"webhook.miles-api.com","x-real-ip":"104.23.175.7","x-forwarded-host":"webhook.miles-api.com","x-forwarded-server":"webhook.miles-api.com","x-forwarded-for":"35.240.244.182, 104.23.175.7","connection":"close","content-length":"436","cf-ray":"93783cbfdc42a2f1-SIN","cf-connecting-ip":"35.240.244.182","accept-encoding":"gzip, br","x-forwarded-proto":"https","content-type":"application/json; charset=utf-8","tracestate":"dd=s:0;p:c884caae955b6621","cf-visitor":"{\"scheme\":\"https\"}","traceparent":"00-680fb923000000001695f2051212a93f-c884caae955b6621-00","x-datadog-tags":"_dd.p.tid=680fb92300000000","cdn-loop":"cloudflare; loops=1","cf-ipcountry":"SG","x-datadog-sampling-priority":"0","x-datadog-parent-id":"14448896355690309153","user-agent":"Wati-webhook/1.0 (https://wati.io; support@wati.io)","x-datadog-trace-id":"1627472943956273471"},"params":{},"query":{},"body":{"eventType":"sentMessageREAD_v2","statusString":"Read","localMessageId":"bab26f51-57da-4541-a059-b8e6624397dd","id":"680fb8a055746b60da320a0c","whatsappMessageId":"wamid.HBgMOTE5NDYwNTk2NDA2FQIAERgSMTcxMjk1NTNDRjg3Q0RBODhGAA==","conversationId":"67cfde7b773e57a5fdb8b754","ticketId":"680f7a0d286e72e14d6279d8","text":null,"type":"template","timestamp":"1745860899","assigneeId":null,"operatorEmail":"mandalam.karan@mileseducation.com"},"webhookUrl":"https://webhook.miles-api.com/webhook/wati-template-read-status","executionMode":"production"}}]},"versionId":"bd1dd48e-47ac-40e8-9650-3abb16a549d5","triggerCount":1,"tags":[{"createdAt":"2025-04-28T13:47:05.635Z","updatedAt":"2025-04-28T13:47:05.635Z","id":"5trY9jUf4K12fkdk","name":"wati"},{"createdAt":"2025-07-15T07:07:49.926Z","updatedAt":"2025-07-15T07:07:49.926Z","id":"wJnVPrhSbmXUFztc","name":"martech"}]}]