[{"createdAt":"2025-04-28T14:02:40.696Z","updatedAt":"2025-07-15T07:13:36.000Z","id":"uAlS6M2XQG5s0zeF","name":"message-wati-template-replied-status","active":true,"nodes":[{"parameters":{"httpMethod":"POST","path":"wati-template-replied-status","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-320,-140],"id":"235998b2-b713-40d8-b7ad-18ea3f2568ee","name":"Webhook","webhookId":"457eb08a-3bae-4591-9d1a-0aa3b556b167"},{"parameters":{"operation":"insert","collection":"lead_history","fields":"=action,actionType,leadId,messageCategory,MessageType,date,messageDescription,attachment,attachmentType,templateId,templateName,conversationId,whatsappMessageId,eventType","options":{}},"type":"n8n-nodes-base.mongoDb","typeVersion":1.1,"position":[800,-140],"id":"86f0105e-147d-4002-beb9-d201818576fa","name":"MongoDB","credentials":{"mongoDb":{"id":"HzXeWVmgs66LJTEK","name":"MongoDB PROD Account"}}},{"parameters":{"assignments":{"assignments":[{"id":"aed6da4a-b1c2-4017-89f0-8e1710977cb8","name":"event_name","value":"wati_message_replied","type":"string"}]},"includeOtherFields":true,"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[140,-140],"id":"9bd9e734-eb17-492f-b4c1-f586ed3d9b86","name":"Edit Fields"},{"parameters":{"jsCode":"return [\n  {\n    json: {\n      action: \"engagement\",\n      actionType: \"messages\",\n      leadId: $input.first().json.id,\n      messageCategory: \"whatsapp\",\n      MessageType: \"outgoing\",\n      date: new Date().toISOString(),\n      messageDescription: $('Webhook').first().json.body.text || \"No message content\",\n      attachment: null,\n      attachmentType: \"planeText\",\n      templateId: $('Webhook').first().json.body.templateId || null,\n      templateName:$('Update Message Status in Supabase (wa_msg_id)').first().json.template_name || null,\n      conversationId: $('Webhook').first().json.body.conversationId || null,\n      whatsappMessageId: $('Webhook').first().json.body.whatsappMessageId || null,\n      eventType: $('Edit Fields').first().json.event_name\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[580,-140],"id":"b2befce2-d8d0-4746-b214-a62015657998","name":"Code"},{"parameters":{"workflowId":{"__rl":true,"value":"tnyhyyA6a3QrZG7L","mode":"list","cachedResultName":"Fetch Lead Details"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[360,-140],"id":"73dfd722-765c-4017-bc07-7339b6f36a17","name":"Fetch Lead Details"},{"parameters":{"workflowId":{"__rl":true,"value":"1tIqfuoSd8QoBAqu","mode":"list","cachedResultName":"Update Message Status in Supabase (wa_msg_id)"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[-60,-140],"id":"95b0b6a2-84cf-49e6-a3bb-d46e5e3b9b9b","name":"Update Message Status in Supabase (wa_msg_id)"}],"connections":{"Webhook":{"main":[[{"node":"Update Message Status in Supabase (wa_msg_id)","type":"main","index":0}]]},"Edit Fields":{"main":[[]]},"Code":{"main":[[{"node":"MongoDB","type":"main","index":0}]]},"Fetch Lead Details":{"main":[[{"node":"Code","type":"main","index":0}]]},"Update Message Status in Supabase (wa_msg_id)":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","timezone":"Asia/Kolkata","saveExecutionProgress":true,"callerPolicy":"workflowsFromSameOwner","errorWorkflow":"osaLco4lVgTtLpKH"},"staticData":null,"meta":null,"pinData":{"Webhook":[{"json":{"headers":{"host":"webhook.miles-api.com","x-real-ip":"172.69.176.88","x-forwarded-host":"webhook.miles-api.com","x-forwarded-server":"webhook.miles-api.com","x-forwarded-for":"34.124.184.187, 172.69.176.88","connection":"close","content-length":"442","cf-ray":"937845f71daac8d1-SIN","cf-connecting-ip":"34.124.184.187","accept-encoding":"gzip, br","x-forwarded-proto":"https","content-type":"application/json; charset=utf-8","tracestate":"dd=s:0;p:7a283629ad1df9c8","cf-visitor":"{\"scheme\":\"https\"}","traceparent":"00-6d0ae0f2944a1fa5b92bffa2b189893b-7a283629ad1df9c8-00","x-datadog-tags":"_dd.p.tid=6d0ae0f2944a1fa5","cdn-loop":"cloudflare; loops=1","cf-ipcountry":"SG","x-datadog-sampling-priority":"0","x-datadog-parent-id":"8802345024321616328","user-agent":"Wati-webhook/1.0 (https://wati.io; support@wati.io)","x-datadog-trace-id":"13343039395243591995"},"params":{},"query":{},"body":{"eventType":"sentMessageREPLIED_v2","statusString":"Replied","localMessageId":"bab26f51-57da-4541-a059-b8e6624397dd","id":"680fb8a055746b60da320a0c","whatsappMessageId":"wamid.HBgMOTE5NDYwNTk2NDA2FQIAERgSMTcxMjk1NTNDRjg3Q0RBODhGAA==","conversationId":"67cfde7b773e57a5fdb8b754","ticketId":"680f7a0d286e72e14d6279d8","text":null,"type":"template","timestamp":"1745861277","assigneeId":null,"operatorEmail":"mandalam.karan@mileseducation.com"},"webhookUrl":"https://webhook.miles-api.com/webhook/wati-template-replied-status","executionMode":"production"}}]},"versionId":"e2931515-e16e-46b7-9fd0-2b3223234535","triggerCount":1,"tags":[{"createdAt":"2025-04-28T13:47:05.635Z","updatedAt":"2025-04-28T13:47:05.635Z","id":"5trY9jUf4K12fkdk","name":"wati"},{"createdAt":"2025-07-15T07:07:49.926Z","updatedAt":"2025-07-15T07:07:49.926Z","id":"wJnVPrhSbmXUFztc","name":"martech"}]}]